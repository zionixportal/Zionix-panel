<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Zionix Panel — Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">
  <header class="flex items-center justify-between px-6 py-4 border-b border-slate-800">
    <div class="flex items-center gap-4">
      <div class="w-10 h-10 rounded bg-gradient-to-tr from-indigo-500 to-pink-500 flex items-center justify-center font-bold">Z</div>
      <div>
        <div class="text-lg font-semibold">Zionix Proxy Panel</div>
        <div class="text-sm text-slate-400">Secure admin dashboard</div>
      </div>
    </div>

    <div class="flex items-center gap-4">
      <div class="text-sm text-slate-400 mr-4">Base: <span class="font-medium text-slate-100">{{ base_url }}</span></div>
      <a href="/logout" class="px-3 py-2 bg-white/5 rounded hover:bg-white/6">Logout</a>
    </div>
  </header>

  <main class="p-6">
    <!-- Metrics -->
    <section class="grid grid-cols-4 gap-4 mb-6">
      <div class="bg-white/3 p-4 rounded-lg">
        <div class="text-sm text-slate-300">Total Proxies</div>
        <div class="text-2xl font-bold">{{ apis|length }}</div>
      </div>
      <div class="bg-white/3 p-4 rounded-lg">
        <div class="text-sm text-slate-300">Active</div>
        <div class="text-2xl font-bold text-emerald-300">{{ apis|selectattr('active')|list|length }}</div>
      </div>
      <div class="bg-white/3 p-4 rounded-lg">
        <div class="text-sm text-slate-300">Inactive</div>
        <div class="text-2xl font-bold text-rose-300">{{ apis|selectattr('active', 'equalto', False)|list|length }}</div>
      </div>
      <div class="bg-white/3 p-4 rounded-lg">
        <div class="text-sm text-slate-300">Quick Actions</div>
        <div class="mt-2 flex gap-2">
          <button id="openCreate" class="px-3 py-2 bg-indigo-500 rounded hover:bg-indigo-600">Add Proxy</button>
          <button onclick="location.reload()" class="px-3 py-2 bg-white/5 rounded hover:bg-white/6">Refresh</button>
        </div>
      </div>
    </section>

    <!-- Create Form (modal) -->
    <div id="createModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-40">
      <div class="bg-slate-800 p-6 rounded-lg w-full max-w-xl">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-lg font-semibold">Create New Proxy</h3>
          <button onclick="closeCreate()" class="text-slate-300">✕</button>
        </div>
        <form method="POST" action="/create" class="space-y-3">
          <div>
            <label class="text-sm text-slate-300">Name (slug)</label>
            <input name="name" required class="w-full p-2 rounded bg-transparent border border-slate-700" placeholder="e.g. mobile">
          </div>
          <div>
            <label class="text-sm text-slate-300">Per-proxy Key</label>
            <input name="api_key" required class="w-full p-2 rounded bg-transparent border border-slate-700" placeholder="unique key for this proxy">
          </div>
          <div>
            <label class="text-sm text-slate-300">Upstream URL (use {term})</label>
            <input name="api_url" required class="w-full p-2 rounded bg-transparent border border-slate-700" placeholder="https://example.com/lookup?term={term}">
          </div>
          <div>
            <label class="text-sm text-slate-300">Duration (hours)</label>
            <input name="duration" type="number" min="1" value="24" class="w-32 p-2 rounded bg-transparent border border-slate-700">
            <span class="text-sm text-slate-500 ml-2">How many hours this proxy stays valid</span>
          </div>
          <div class="flex justify-end gap-2 mt-4">
            <button type="button" onclick="closeCreate()" class="px-4 py-2 rounded border">Cancel</button>
            <button type="submit" class="px-4 py-2 bg-indigo-500 rounded hover:bg-indigo-600">Create Proxy</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Proxies list -->
    <section id="proxies" class="space-y-4">
      {% for p in apis %}
      <div class="bg-white/2 p-4 rounded-lg flex flex-col md:flex-row md:items-center justify-between gap-3">
        <div>
          <div class="flex items-center gap-3">
            <div class="text-xl font-bold">{{ p.name }}</div>
            {% if p.active %}
              <div class="text-xs px-2 py-1 rounded bg-emerald-600/25 text-emerald-300">Active</div>
            {% else %}
              <div class="text-xs px-2 py-1 rounded bg-rose-600/25 text-rose-300">Inactive</div>
            {% endif %}
          </div>
          <div class="text-sm text-slate-400 mt-1">Upstream: <span class="text-slate-200">{{ p.api_url }}</span></div>
          <div class="text-sm text-slate-400 mt-1">Created: <span class="text-slate-200">{{ p.created_at or '' }}</span></div>
          <div class="text-sm text-slate-400 mt-1">Expires: <span class="text-slate-200">{{ p.expires_at or p.expires_at }}</span></div>
        </div>

        <div class="flex items-center gap-3">
          <div class="text-xs text-slate-300">Key</div>
          <div class="bg-white/5 px-3 py-1 rounded text-slate-100 font-mono text-sm" id="key_{{ p.id }}">{{ p.api_key }}</div>

          <div class="text-sm text-slate-300">Proxy URL</div>
          <div class="bg-white/5 px-3 py-1 rounded text-slate-100 font-mono text-sm">
            <span id="proxy_display_{{ p.id }}">{{ base_url }}/api/{{ p.api_key }}/{{ p.name }}/<em class="text-slate-400">{term}</em></span>
          </div>

          <button class="px-3 py-1 bg-white/6 rounded" onclick="copyProxy({{ p.id }})">Copy</button>
          <a href="/edit/{{ p.id }}" class="px-3 py-1 bg-indigo-600 rounded text-sm hover:bg-indigo-700">Edit</a>
          <a href="/delete/{{ p.id }}" onclick="return confirm('Delete proxy?')" class="px-3 py-1 bg-rose-600 rounded text-sm hover:bg-rose-700">Delete</a>
        </div>
      </div>
      {% else %}
      <div class="bg-white/2 p-4 rounded-lg text-slate-300">No proxies yet. Click “Add Proxy”.</div>
      {% endfor %}
    </section>
  </main>

  <script src="/static/panel.js"></script>
  <script>
    const createModal = document.getElementById('createModal');
    document.getElementById('openCreate').addEventListener('click', ()=> {
      createModal.classList.remove('hidden'); createModal.classList.add('flex');
    });
    function closeCreate(){ createModal.classList.add('hidden'); createModal.classList.remove('flex'); }

    function copyProxy(id){
      const el = document.getElementById('proxy_display_' + id);
      const text = el.innerText.replace(/\s+/g, '');
      navigator.clipboard?.writeText(text).then(()=> alert('Copied!')).catch(()=> prompt('Copy proxy URL', text));
    }
  </script>
</body>
            </html>        <input id="a_tpl" placeholder="url template (use {term})" class="w-full p-3 bg-transparent border rounded">
        <input id="a_key" placeholder="per-proxy API key (required)" class="w-full p-3 bg-transparent border rounded">
        <div class="flex gap-2">
          <select id="a_loc" class="p-2 rounded bg-transparent border">
            <option value="query">query</option>
            <option value="header">header</option>
            <option value="cookie">cookie</option>
          </select>
          <input id="a_cookie" placeholder="cookie name (if cookie)" class="flex-1 p-2 bg-transparent border rounded">
        </div>
        <input id="a_strip" placeholder="strip fields (comma separated)" class="w-full p-3 bg-transparent border rounded">
        <textarea id="a_add" placeholder='add fields JSON e.g. {"by":"Aditech"}' class="w-full p-3 bg-transparent border rounded"></textarea>
        <input id="a_owner" placeholder="owner credit (kept private unless injected)" class="w-full p-3 bg-transparent border rounded">
      </div>
      <div class="mt-4 flex gap-2 justify-end">
        <button onclick="closeAdd()" class="px-4 py-2 rounded border">Cancel</button>
        <button onclick="doAdd()" class="px-4 py-2 bg-indigo-500 rounded">Add Proxy</button>
      </div>
    </div>
  </div>

  <script src="/static/panel.js"></script>
</body>
</html>
